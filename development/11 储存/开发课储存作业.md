储存作业

## 问：选取3个类型数据，说明你会选择什么存储，为什么？

资料类：头像、昵称、角色、注册信息等

经济类：游戏中的虚拟货币等

道具类：物品、装备、avatar、邮件等

技能类：技能、天赋等

属性类：经验、等级、vip信息等

任务类：任务类型、状态、进度、奖励等

场景类：地图、坐标、关卡、存档等

社交类：工会、配偶、游戏好友等

其他：资源文件、配置、日志、账单等运营数据

## 答：

#### **配置**：

对于配置文件，如果是单个程序的配置文件，则会采用与程序代码放在一起的方式，通常代码中会有一个叫做resources的目录，此处会放置一些需要的配置文件，通常的本地配置文件格式为yaml（如docker软件等），properties（java软件等），还有xml（spring等）。

对于分布式的服务来说，则需要对一个集群的服务的配置文件进行统一管理，此时一般选择zookeeper作为配置文件的储存方式，格式则依旧是yaml,xml,json,properties等。因为zookeeper内部实现的paxos能够很好的解决分布式服务的共识问题，为分布式服务的配置管理给出了优雅的解决方案。

#### **日志**：

日志文件在服务端一般会储存近期的本地文件作为储存，方便出现问题是进行排查。而长期的日志则会存到相应的中间件，目前业界已经有成熟的解决方案，比如ELK（[ELK Stack: Elasticsearch, Logstash, Kibana](https://www.elastic.co/what-is/elk-stack)）解决方案，一套开源的日志管理方案。他们分别具有以下功能：

- Logstash：负责日志的收集，处理和储存
- Elasticsearch：负责日志检索和分析
- Kibana：负责日志的可视化

通过成熟的日志管理软件，可以构建高可用的服务，软件不仅自动化的对日志的收集，处理和储存，检索和分析并具有可视化功能，还可以进行服务监控，在需要的时候自定义地进行报警或者服务降级，熔断等等。

在客户端则对于关键数据会在相应的埋点处，将日志上报服务端。对于非关键的数据则会储存在本地，当遇到问题时再上报数据。

#### **经济类**：

虚拟货币一般使用具有ACID特质的关系型数据库，比如mysql等，因为虚拟货币类似于现实货币对一致性，持久性，原子性等要求较高。并且某些场景需要事务支持。

#### **社交类** 

对于普通的业务，一般可以使用关系型数据库，比如mysql等进行持久化储存，Redis等缓存来保证服务质量和响应速度。对于某些特定的业务场景，还可以使用图数据库来储存，该类型数据库可以很好的利用关系之间的拓扑关系。其次这些数据还可以使用HBASE与HBASE进行储存，构建宽表。大数据的储存可以为后续的算法推荐和用户画像等提供基础服务。

#### **资料类，道具类，属性类**：

使用具有ACID特质的关系型数据库，比如mysql或者MongoDB这样的文档型数据库皆可。若需要进行业务的快速迭代和开发，则推荐无模式的MongoDB文档型数据库，因为可以随时改变关系结构。若是核心的需要稳定性为主的业务则推荐使用mysql为代表的关系型数据库。